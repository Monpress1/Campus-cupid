<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campus Cupid ❤️</title>

  <!-- ✅ PWA essentials -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#fbbf24">
  <link rel="icon" href="/images/icons/icon-192x192.png">

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, #0f172a, #1e293b, #334155);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      padding: 2rem;
      border-radius: 1rem;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      animation: fadeIn 0.8s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    h1 {
      text-align: center;
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
      color: #fbbf24;
    }
    h1 i { margin-right: 8px; color: #ef4444; }
    input, select, button {
      width: 90%;
      padding: 0.8rem;
      margin: 0.5rem 0;
      border: none;
      border-radius: 0.5rem;
      font-size: 1rem;
    }
    input, select {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
    }
    input::placeholder { color: #bbb; }
    button {
      background: #fbbf24;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover { background: #f59e0b; }
    .toggle { text-align: center; margin-top: 1rem; cursor: pointer; color: #93c5fd; }
    .hidden { display: none; }
    .row { display: flex; gap: 0.5rem; }
    .row select { flex: 1; }

    /* Banner styling */
    #installBanner {
      display:none;
      position:fixed;
      bottom:0;
      left:0;
      right:0;
      background:#222;
      color:#fff;
      padding:1em;
      text-align:center;
      z-index:1000;
    }
    #installBanner button {
      margin-left:1em;
      padding:0.5em 1em;
      background:#fbbf24;
      color:#000;
      border:none;
      border-radius:0.5rem;
      font-weight:bold;
      cursor:pointer;
    }

    @media (max-width: 480px) {
      .container { margin: 1rem; padding: 1.5rem; }
      h1 { font-size: 1.5rem; }
      .row { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1><i class="fa-solid fa-heart-circle-bolt"></i> Campus Cupid</h1>

    <!-- Login Form -->
    <form id="login-form">
      <input type="email" id="login-email" placeholder="Email" required>
      <input type="password" id="login-password" placeholder="Password" required>
      <button type="submit">Login</button>
    </form>

    <!-- Signup Form -->
    <form id="signup-form" class="hidden">
      <input type="text" id="signup-username" placeholder="Username" required>
      <input type="email" id="signup-email" placeholder="Email" required>
      <input type="password" id="signup-password" placeholder="Password" required>
      <input type="password" id="signup-confirm" placeholder="Confirm Password" required>

      <div class="row"> 
        <select id="signup-gender" required>
          <option value="">Gender</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
          <option value="other">Other</option>
        </select>
        <select id="signup-age" required>
          <option value="">Age</option>
        </select>
      </div>

      <button type="submit">Sign Up</button>
    </form>

    <div class="toggle" id="toggle-view">Don’t have an account? Sign up</div>
  </div>

  <!-- ✅ Custom install banner -->
  <div id="installBanner">
    Install Campus Cupid for a better experience!
    <button id="installBtn">Install</button>
  </div>

  <script>
    const supabase = window.supabase.createClient(
      "https://vfbjwkfurleatfdrabdg.supabase.co", 
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZmYmp3a2Z1cmxlYXRmZHJhYmRnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc0MjAwNDIsImV4cCI6MjA3Mjk5NjA0Mn0.hguIfyynGc19tsSm9u66qy5IeUv40_mE8-JBjqnOQBE"
    );

    const loginForm = document.getElementById("login-form");
    const signupForm = document.getElementById("signup-form");
    const toggleView = document.getElementById("toggle-view");

    // Populate age dropdown
    const ageSelect = document.getElementById("signup-age");
    for (let i = 16; i <= 60; i++) {
      const option = document.createElement("option");
      option.value = i;
      option.textContent = i;
      ageSelect.appendChild(option);
    }

    toggleView.addEventListener("click", () => {
      loginForm.classList.toggle("hidden");
      signupForm.classList.toggle("hidden");
      toggleView.textContent = loginForm.classList.contains("hidden")
        ? "Already have an account? Login"
        : "Don’t have an account? Sign up";
    });

    // Login
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("login-email").value;
      const password = document.getElementById("login-password").value;
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) {
        alert(error.message);
      } else {
        window.location.href = "profile.html";
      }
    });

    // Signup
    signupForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const username = document.getElementById("signup-username").value;
      const email = document.getElementById("signup-email").value;
      const password = document.getElementById("signup-password").value;
      const confirm = document.getElementById("signup-confirm").value;
      const gender = document.getElementById("signup-gender").value;
      const age = document.getElementById("signup-age").value;

      if (password !== confirm) {
        alert("Passwords do not match");
        return;
      }

      const { data, error } = await supabase.auth.signUp({ email, password });
      if (error) {
        alert(error.message);
      } else {
        const user = data.user;
        if (user) {
          await supabase.from("profiles").insert([
            { user_id: user.id, full_name: username, gender: gender,
              age: age, bio: "", interests: [], is_premium: false }
          ]);
        }
        alert("Signup successful! Please log in.");
        signupForm.reset();
        signupForm.classList.add("hidden");
        loginForm.classList.remove("hidden");
        toggleView.textContent = "Don’t have an account? Sign up";
      }
    });

    /* ✅ Register the service worker for PWA */
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker
          .register('/sw.js')
          .then(() => console.log('Service Worker registered'))
          .catch(err => console.error('SW registration failed', err));
      });
    }

    /* ✅ Custom install banner logic */
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installBanner').style.display = 'block';
    });

    document.getElementById('installBtn').addEventListener('click', () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      deferredPrompt.userChoice.finally(() => {
        deferredPrompt = null;
        document.getElementById('installBanner').style.display = 'none';
      });
    });
  </script>
</body>
</html>
